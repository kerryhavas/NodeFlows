var fs = require("fs");
var logManager = require("./logManager.js");
var statManager = require("./statManager.js");
var nodeFlows = require('./nodeFlows');

var environmentStorage = {};

var environmentPathRoot = "./node_modules/nodeFlows/workflows/";

var path = "";

fs.readdir('./node_modules/nodeFlows/environments/', function (err, files) {
    if (err) throw err;
    files.forEach(function (file) {
        
        var stat = fs.statSync(environmentPathRoot + path + file);

        if(stat.isDirectory()) {
            //logging.log("Is A Directory");
            // if(file != "Inactive") {                //Skip loading files in active directory
            //    readWorkflowDefinitions(path + file + "/");
            // }
        }
        else {
            //logging.log("Is a file");
            log("Adding Environment from file:" + path + file);
            var environmentName = (path + file).replace(".js", "");
            log("environmentName:" + environmentName);
            var environment = { name: environmentName };
            var environmentModule = require("./environments/" + path + file);
            environment.module = environmentModule;

            environmentStorage[environmentName] = environment;

            if(environmentModule.environmentDefinition.workers == undefined) {
                //queueManager.addQueueWorker(workflowName);
            } else {
                // for(var i = 0; i < workflowModule.workflowDefinition.workers; i++) {
                //     queueManager.addQueueWorker(workflowName);
                //  }
            }
        }
    });
});